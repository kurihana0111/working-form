<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>長期照顧計畫生成器</title>
    <!-- 載入 React 核心庫 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-[#FFFBEB]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // SVG 圖標組件
        const Icons = {
            Heart: ({ size = 20, fill = "none" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14m-7-7v14"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            ArrowUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>,
            ArrowDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>,
            Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Activity: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        };

        const familyTitles = [
            "案妻", "案夫", "案父", "案母", 
            "案長兄", "案次兄", "案三兄", "案大弟", "案次弟", "案三弟",
            "案大姐", "案次姐", "案三姐", "案大妹", "案次妹", "案三妹",
            "案長子", "案次子", "案三子", "案長女", "案次女", "案三女", "其它"
        ];

        const App = () => {
            const [formData, setFormData] = useState({
                dateInfo: { visitDate: '', submitDate: '', type: 'AA01家訪' },
                expectations: { reason: '', service: '居家', contactPerson: '', visitWith: '', changeNote: '此次訪視服務不變', newServices: [] },
                status: { identity: '一般', handicap: '無', handicapDegree: '輕度', subsidy: '無', cohabit: '', mainCaregiver: '', contactPerson: '', marital: '已婚', familyMembers: [], familyType: [], siblingRank: '一', sonCount: '0', daughterCount: '0' },
                environment: { type: '自有透天厝', thresholds: '', tools: '', repairNeed: '暫無輔具及居家無障礙修繕需求' },
                medical: { diseases: '', followUp: '', tubes: '', wounds: '', hospitalized: '', rehab: '' },
                currentVisit: { appearance: '', consciousness: '意識清楚', vision: '正常', hearing: '正常', memory: '尚可', limbs: '', emotion: '穩定' },
                adls: { eating: '自理', bathing: '自理', dressing: '自理', toilet: '自理', transfer: '自理', walking: '自理', fall: '無' },
                plan: { cms: '', respite: { interval: '114/01-115/03', remainGa: '32340/48510', remainSc: '87780/71610' } },
                caseManager: '楊欣宜',
                phone: '04-7565035'
            });

            const [output, setOutput] = useState('');

            const generateOutput = () => {
                const { dateInfo, expectations, status, environment, medical, currentVisit, adls, plan } = formData;
                let text = `一、${dateInfo.type}日期：${dateInfo.visitDate}，計畫送審日期：${dateInfo.submitDate}\n\n`;
                text += `二、照顧計畫內容：\n(一) 家屬期待：因為${expectations.reason}，期望持續使用${expectations.service}服務減輕照顧壓力。\n`;
                text += `本此與${expectations.contactPerson}聯繫 / ${expectations.visitWith}共同訪視。\n*${expectations.changeNote}。\n\n`;
                
                text += `(二) 個案目前狀況：\n1.個案為長照${status.identity}戶，${status.handicap === '有' ? '領有身障手冊' : '未領有身障手冊'}。領有${status.subsidy}津貼。\n`;
                text += `2.家庭狀況：個案${status.marital}，現與${status.cohabit || 'Ｏ'}同住。主要照顧者為${status.mainCaregiver || 'Ｏ'}。家庭詳細如下：\n`;
                status.familyMembers.forEach(m => {
                    text += `◎${m.title}(${m.name}/${m.year})：${m.marital}、住${m.location || 'Ｏ'}、${m.note}\n`;
                });
                
                text += `\n3.居住環境及輔具：\n案家為${environment.type}，${environment.thresholds ? environment.thresholds + '處' : '無'}門檻，家中備有${environment.tools || '無'}，${environment.repairNeed}。\n\n`;
                text += `4.個案疾病史：\n${medical.diseases || '無明顯疾病史'}；${medical.followUp}；${medical.tubes}；${medical.wounds}。\n\n`;
                text += `5.個案訪視時狀態：外觀${currentVisit.appearance}；${currentVisit.consciousness}；視力${currentVisit.vision}；聽力${currentVisit.hearing}；四肢狀況${currentVisit.limbs}。\n\n`;
                text += `6.ADLs評估：進食${adls.eating}、沐浴${adls.bathing}、穿衣${adls.dressing}、如廁${adls.toilet}、移位${adls.transfer}、行走${adls.walking}、跌倒${adls.fall}。\n\n`;
                text += `三、照顧計畫：CMS：${plan.cms}，核定如下：\n◎喘息服務區間${plan.respite.interval}。\nGA09剩餘${plan.respite.remainGa}元；SC09剩餘${plan.respite.remainSc}元。\n`;
                text += `\n※A個管員：${formData.caseManager}　※連絡電話：${formData.phone}`;
                setOutput(text);
            };

            useEffect(() => { generateOutput(); }, [formData]);

            const handleInputChange = (section, field, value) => {
                setFormData(prev => ({ ...prev, [section]: { ...prev[section], [field]: value } }));
            };

            const addFamilyMember = () => {
                const newMember = { id: Date.now(), title: '案長子', name: '', year: '', marital: '已婚', location: '', note: '' };
                setFormData(prev => ({ ...prev, status: { ...prev.status, familyMembers: [...prev.status.familyMembers, newMember] } }));
            };

            const updateFamilyMember = (id, field, value) => {
                const newMembers = formData.status.familyMembers.map(m => m.id === id ? { ...m, [field]: value } : m);
                setFormData(prev => ({ ...prev, status: { ...prev.status, familyMembers: newMembers } }));
            };

            const moveMember = (index, direction) => {
                const newMembers = [...formData.status.familyMembers];
                const target = index + direction;
                if (target < 0 || target >= newMembers.length) return;
                [newMembers[index], newMembers[target]] = [newMembers[target], newMembers[index]];
                setFormData(prev => ({ ...prev, status: { ...prev.status, familyMembers: newMembers } }));
            };

            const copyToClipboard = () => {
                const textarea = document.createElement('textarea');
                textarea.value = output;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('已成功複製到剪貼簿！');
            };

            const InputGroup = ({ label, icon: Icon, color, children }) => (
                <div className="mb-6 bg-white p-5 rounded-3xl shadow-sm border border-gray-100 animate-in">
                    <h3 className={`text-sm font-bold ${color} mb-4 flex items-center gap-2 uppercase tracking-wider`}>
                        <Icon /> {label}
                    </h3>
                    <div className="space-y-4">{children}</div>
                </div>
            );

            return (
                <div className="flex flex-col md:flex-row h-screen overflow-hidden">
                    {/* 表單區 */}
                    <div className="w-full md:w-1/2 overflow-y-auto p-6 scrollbar-hide bg-[#FFFBEB]">
                        <header className="mb-8 flex items-center gap-3">
                            <div className="bg-orange-500 p-2 rounded-2xl text-white"><Icons.Heart fill="white" /></div>
                            <div>
                                <h1 className="text-xl font-bold tracking-tight">長照計畫生成器</h1>
                                <p className="text-[10px] text-orange-400 font-bold uppercase tracking-widest">Full Version 2.0</p>
                            </div>
                        </header>

                        <InputGroup label="基本時程" icon={Icons.Calendar} color="text-orange-500">
                            <div className="grid grid-cols-2 gap-3">
                                <select className="bg-orange-50 p-3 rounded-2xl outline-none text-sm" value={formData.dateInfo.type} onChange={e => handleInputChange('dateInfo', 'type', e.target.value)}>
                                    <option>AA01家訪</option><option>複評</option>
                                </select>
                                <input type="date" className="bg-orange-50 p-3 rounded-2xl outline-none text-sm" onChange={e => handleInputChange('dateInfo', 'visitDate', e.target.value)} />
                            </div>
                            <input placeholder="期待原因 (例:中風肢體無力)" className="w-full bg-orange-50 p-3 rounded-2xl outline-none text-sm" onChange={e => handleInputChange('expectations', 'reason', e.target.value)} />
                        </InputGroup>

                        <InputGroup label="家庭補充表" icon={Icons.User} color="text-purple-500">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-[10px] font-bold text-gray-400">成員列表</span>
                                <button onClick={addFamilyMember} className="bg-purple-500 text-white p-1.5 rounded-full shadow-md active:scale-90 transition-all"><Icons.Plus /></button>
                            </div>
                            <div className="space-y-4">
                                {formData.status.familyMembers.map((m, idx) => (
                                    <div key={m.id} className="p-4 bg-purple-50 rounded-2xl border border-purple-100 space-y-3 relative">
                                        <div className="flex justify-between items-center">
                                            <div className="flex gap-2">
                                                <div className="flex flex-col">
                                                    <button onClick={() => moveMember(idx, -1)} className="text-purple-300 hover:text-purple-600"><Icons.ArrowUp /></button>
                                                    <button onClick={() => moveMember(idx, 1)} className="text-purple-300 hover:text-purple-600"><Icons.ArrowDown /></button>
                                                </div>
                                                <select className="bg-white px-2 py-1 rounded-xl text-xs font-bold outline-none" value={m.title} onChange={e => updateFamilyMember(m.id, 'title', e.target.value)}>
                                                    {familyTitles.map(t => <option key={t}>{t}</option>)}
                                                </select>
                                            </div>
                                            <button onClick={() => setFormData(p => ({...p, status: {...p.status, familyMembers: p.status.familyMembers.filter(i => i.id !== m.id)}}))} className="text-red-300 hover:text-red-500"><Icons.Trash /></button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input placeholder="姓名" className="bg-white p-2 rounded-xl text-xs outline-none" value={m.name} onChange={e => updateFamilyMember(m.id, 'name', e.target.value)} />
                                            <input placeholder="年次" className="bg-white p-2 rounded-xl text-xs outline-none" value={m.year} onChange={e => updateFamilyMember(m.id, 'year', e.target.value)} />
                                        </div>
                                        <input placeholder="備註 (住址/探視狀況)" className="w-full bg-white p-2 rounded-xl text-xs outline-none" value={m.note} onChange={e => updateFamilyMember(m.id, 'note', e.target.value)} />
                                    </div>
                                ))}
                            </div>
                        </InputGroup>

                        <InputGroup label="環境與疾病" icon={Icons.Home} color="text-green-600">
                            <div className="grid grid-cols-2 gap-3">
                                <input placeholder="居住類型 (透天/公寓)" className="bg-green-50 p-3 rounded-2xl outline-none text-sm" value={formData.environment.type} onChange={e => handleInputChange('environment', 'type', e.target.value)} />
                                <input placeholder="門檻處數" className="bg-green-50 p-3 rounded-2xl outline-none text-sm" value={formData.environment.thresholds} onChange={e => handleInputChange('environment', 'thresholds', e.target.value)} />
                            </div>
                            <textarea placeholder="疾病史紀錄 (高血壓、糖尿病...)" className="w-full bg-green-50 p-3 rounded-2xl outline-none text-sm h-20 resize-none" onChange={e => handleInputChange('medical', 'diseases', e.target.value)} />
                        </InputGroup>

                        <InputGroup label="ADLs 評估" icon={Icons.Activity} color="text-red-500">
                            <div className="grid grid-cols-2 gap-3">
                                {Object.keys(formData.adls).map(key => (
                                    <div key={key} className="bg-red-50/50 p-2 rounded-xl">
                                        <span className="text-[10px] text-red-400 font-bold ml-1 mb-1 block uppercase">{key}</span>
                                        <select className="w-full bg-white p-1.5 rounded-lg text-xs outline-none" value={formData.adls[key]} onChange={e => handleInputChange('adls', key, e.target.value)}>
                                            <option>自理</option><option>部分協助</option><option>完全協助</option>
                                            {key === 'fall' && <option>有</option>}
                                            {key === 'fall' && <option>無</option>}
                                        </select>
                                    </div>
                                ))}
                            </div>
                        </InputGroup>
                    </div>

                    {/* 預覽區 */}
                    <div className="w-full md:w-1/2 flex flex-col bg-white border-l">
                        <div className="p-6 flex justify-between items-center border-b bg-gray-50/50 backdrop-blur-sm">
                            <span className="text-xs font-black text-orange-500 uppercase tracking-widest">Output Preview</span>
                            <button onClick={copyToClipboard} className="bg-orange-500 text-white px-6 py-2.5 rounded-full text-xs font-bold shadow-lg flex items-center gap-2 active:scale-95 transition-all">
                                <Icons.Copy /> 複製全文
                            </button>
                        </div>
                        <div className="flex-1 p-8 overflow-y-auto bg-white/50">
                            <div className="max-w-prose mx-auto bg-white p-10 rounded-[2.5rem] shadow-2xl shadow-orange-100 text-[14px] leading-relaxed whitespace-pre-wrap font-mono text-gray-700">
                                {output}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
